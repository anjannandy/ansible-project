# Vault HTTPS Configuration Generated by Ansible
# Node: {{ inventory_hostname }}
# Generated: {{ ansible_date_time.iso8601 }}

ui = true

# HTTPS Listener
listener "tcp" {
  address       = "0.0.0.0:{{ vault_port }}"
  tls_cert_file = "{{ vault_certs_dir }}/vault-cert.pem"
  tls_key_file  = "{{ vault_certs_dir }}/vault-key.pem"
  tls_ca_file   = "{{ vault_certs_dir }}/vault-ca.pem"

  # Security settings
  tls_min_version = "tls12"
  tls_require_and_verify_client_cert = false
  tls_disable_client_certs = false
}

# Cluster listener for inter-node communication
listener "tcp" {
  address         = "0.0.0.0:{{ vault_cluster_port }}"
  cluster_address = "{{ ansible_host }}:{{ vault_cluster_port }}"
  tls_cert_file   = "{{ vault_certs_dir }}/vault-cert.pem"
  tls_key_file    = "{{ vault_certs_dir }}/vault-key.pem"
  tls_ca_file     = "{{ vault_certs_dir }}/vault-ca.pem"
}

# PostgreSQL storage backend
storage "postgresql" {
  connection_url = "postgresql://{{ vault_db_user }}:{{ vault_db_password }}@{{ vault_db_host }}:{{ vault_db_port }}/{{ vault_db_name }}?sslmode=disable&connect_timeout=10&statement_timeout=30000&idle_in_transaction_session_timeout=60000"
  table          = "{{ vault_table }}"
  max_parallel   = 128
}

# Cluster configuration
cluster_addr  = "https://{{ ansible_host }}:{{ vault_cluster_port }}"
api_addr      = "https://{{ ansible_host }}:{{ vault_port }}"
cluster_name  = "vault-cluster"

# Disable mlock for development (remove in production)
disable_mlock = true

# Log level
log_level = "INFO"
log_format = "standard"

# Default lease and max lease TTL
default_lease_ttl = "768h"  # 32 days
max_lease_ttl = "8760h"     # 1 year

# Raw storage endpoint
raw_storage_endpoint = true